Скрипт "SystemDrive Folder NTFS privileges restorer" by Alex Dragokas

Назначение:
Применяется, когда NTFS-права корня системного диска повреждены.
Примеры признаков:
отказ в доступе при записи в корень диска C:

-------------------------------
Стандартные права:
-------------------------------

1) Формальное сокращенное описание (для быстрой оценки):
Пользователям из группы "администраторы" разрешается запись файлов в корень диска C: после прохождения проверки UAC.
Пользователям из групп "администраторы" и "пользователи" разрешается создание папок в корне диска C:.

2) Подробный список прав:
Спойлер
Введите icacls %SystemDrive%\ для проверки.

Для Windows Vista / 7:

BUILTIN\Администраторы:(F)
BUILTIN\Администраторы:(OI)(CI)(IO)(F)
NT AUTHORITY\система:(F)
NT AUTHORITY\система:(OI)(CI)(IO)(F)
BUILTIN\Пользователи:(OI)(CI)(RX)
NT AUTHORITY\Прошедшие проверку:(OI)(CI)(IO)(M)
NT AUTHORITY\Прошедшие проверку:(AD)
Обязательная метка\Высокий обязательный уровень:(OI)(NP)(IO)(NW)

Для Windows 8 / 8.1 / 10:

BUILTIN\Администраторы:(OI)(CI)(F)
NT AUTHORITY\СИСТЕМА:(OI)(CI)(F)
BUILTIN\Пользователи:(OI)(CI)(RX)
NT AUTHORITY\Прошедшие проверку:(OI)(CI)(IO)(M)
NT AUTHORITY\Прошедшие проверку:(AD)
Обязательная метка\Высокий обязательный уровень:(OI)(NP)(IO)(NW)


-------------------------------

Использование:

Распаковать архив.
Запустить файл "SysDrive Permissions Restorer.cmd" правой кнопкой мыши "От имени администратора".
Показать отчёт Perm_Log_U.log специалисту.

-------------------------------

Пример лога с успешными операциями:

SystemDrive Folder NTFS privileges restorer script by Alex Dragokas (v.1.0)

Please wait ...

17.04.2017 - 19:24:06,49

Checking requirements
C:\Windows\System32\takeown.exe
C:\Windows\System32\icacls.exe
C:\Windows\System32\find.exe
OS:

Microsoft Windows [Version 6.1.7601]
SystemDrive is: C:
Имя тома:
Серийный номер тома: 0xa4780dd6
Максимальная длина компонентов: 255
Имя файловой системы: NTFS
Поддерживает учет регистров в именах файлов
Сохраняет имена файлов с учетом регистра
Поддерживает использование Юникода в именах файлов
Поддерживает обязательное использование списков доступа (ACL)
Поддерживает сжатие файлов
Поддерживает дисковые квоты
Поддерживает разреженные файлы
Поддерживает точки повторной обработки
Поддерживает идентификаторы объектов
Поддерживает шифрование на уровне файловой системы (EFS)
Поддерживает именованные потоки
Поддержка транзакций
Поддерживает жесткие ссылки
Поддерживает расширенные атрибуты
Поддерживает открытие по идентификатору файла
Поддерживает журнал USN

Backup
C:\ BUILTIN\Администраторы:(F)
BUILTIN\Администраторы:(OI)(CI)(IO)(F)
NT AUTHORITY\система:(F)
NT AUTHORITY\система:(OI)(CI)(IO)(F)
BUILTIN\Пользователи:(OI)(CI)(RX)
NT AUTHORITY\Прошедшие проверку:(OI)(CI)(IO)(M)
NT AUTHORITY\Прошедшие проверку:(AD)
Обязательная метка\Высокий обязательный уровень:(OI)(NP)(IO)(NW)
Успешно обработано 1 файлов; не удалось обработать 0 файлов
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов
ACL backup stored in: "C:\Users\tfcor\Desktop\SysDrive.acl"

Changing owner

Успех. Владельцем файла (или папки) "C:\" является группа администраторов.

Removing 'deny' privileges

>>> icacls C:\ /remove:d "BUILTIN\Администраторы"
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /remove:d "BUILTIN\Администраторы"
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /remove:d "NT AUTHORITY\система"
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /remove:d "NT AUTHORITY\система"
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /remove:d "BUILTIN\Пользователи"
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /remove:d "NT AUTHORITY\Прошедшие проверку"
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /remove:d "NT AUTHORITY\Прошедшие проверку"
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /remove:d "Обязательная метка\Высокий обязательный уровень"
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /remove:d "шно обработано 1 файлов; не удалось обработать 0 файлов"
Успешно обработано 0 файлов; не удалось обработать 0 файлов

Restoring privileges
Applying Window 7 template...

>>> icacls C:\ /grant:r *S-1-5-32-544:(F)
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /grant:r *S-1-5-32-544:(OI)(CI)(IO)(F)
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /grant:r *S-1-5-18:(F)
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /grant:r *S-1-5-18:(OI)(CI)(IO)(F)
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /grant:r *S-1-5-32-545:(OI)(CI)(RX)
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /grant:r *S-1-5-11:(OI)(CI)(IO)(M)
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

>>> icacls C:\ /grant:r *S-1-5-11:(AD)
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

Setting integrity level

>>> icacls C:\ /setintegritylevel (OI)(IO)(NP)H
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

Restoring owner

>>> icacls C:\ /setowner *S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464
обработанный файл: C:\
Успешно обработано 1 файлов; не удалось обработать 0 файлов

List of new permissions
C:\ BUILTIN\Администраторы:(F)
BUILTIN\Администраторы:(OI)(CI)(IO)(F)
NT AUTHORITY\система:(F)
NT AUTHORITY\система:(OI)(CI)(IO)(F)
BUILTIN\Пользователи:(OI)(CI)(RX)
NT AUTHORITY\Прошедшие проверку:(OI)(CI)(IO)(M)
NT AUTHORITY\Прошедшие проверку:(AD)
Обязательная метка\Высокий обязательный уровень:(OI)(NP)(IO)(NW)
Успешно обработано 1 файлов; не удалось обработать 0 файлов

LogFile stored in: "C:\Users\tfcor\Desktop\Perm_Log_U.log"

Script is finished.
Show this logfile to helper.

Работа скрипта завершена.
Покажите этот отчёт специалисту.

------------------------------


Совместимость:
Windows 10 / 8.1 / 8 / 7 / Vista

Примечание:
Скрипт не удаляет разрешающие привилегии. Если у Вас установлены лишние привилегии разрешения доступа, Вам придётся удалять их самостоятельно.


